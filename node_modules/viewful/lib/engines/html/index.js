var html = require('html-lang');

// TODO: remove cheerio require, $ should be scoped in View
var cheerio = require('cheerio');

exports.attach = function (options) {
  this.html = {

    render : function (view, data, cb) {
      
      var str;
      console.log(typeof view.layout)
      
      if(typeof view.layout !== 'undefined') {
        var $ = cheerio.load(view.layout);
        $('#main').html(view.template);
      } else {
        var $ = cheerio.load(view.template);
      }
      //console.log($.html())
      str = html.render(data, $.html());
      if (cb) {
        return cb(null, str);
      } else {
        return str;
      }
    }

    
  }
};

// `exports.init` gets called by broadway on `app.init`.
exports.init = function (done) {
};