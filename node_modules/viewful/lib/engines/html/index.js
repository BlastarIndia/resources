// var html = require('html-lang');

// TODO: remove cheerio require, $ should be scoped in View
var cheerio = require('cheerio');

exports.attach = function (options) {
  this.html = {

    render : function (view, data, cb) {
      var str;
      if(typeof view.layout !== 'undefined') {
        var $ = cheerio.load(view.layout);
        $('#main').html(view.template);
      } else {
        var $ = cheerio.load(view.template);
      }
      //str = html.render(data, $.html());
      str = $.html();
      if (cb) {
        return cb(null, str);
      } else {
        return str;
      }
    }

  }
};

// `exports.init` gets called by broadway on `app.init`.
exports.init = function (done) {
};

exports.render = function (view, data, cb) {
  var str;
  if(typeof view.layout !== 'undefined') {
    var $ = cheerio.load(view.layout);
    $('#main').html(view.template);
  } else {
    var $ = cheerio.load(view.template);
  }
  //console.log($.html())
  //str = html.render(data, $.html());
  str = $.html();
  if (cb) {
    return cb(null, str);
  } else {
    return str;
  }
}