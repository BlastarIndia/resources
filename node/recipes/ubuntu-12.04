#!/usr/bin/env sh

#
#  noc - ubuntu-12.04
#
#  bootstraps a fresh ubuntu-12.04 image with stable node.js and tiny replicator
#
#

# update apt-get
apt-get -y update

# install git
apt-get -y install git-core

# clone node from github
git clone https://github.com/joyent/node.git

# change directory into node
cd node

# checkout a reasonable node version
git checkout v0.8.9

# install some missing deps
apt-get -y install g++ curl libssl-dev apache2-utils

# install some useful tools
apt-get -y install members

# configure
./configure

# install make
apt-get -y install make

# make
sudo make

# install
sudo make install

# back to home
cd ..

# remove the update-motd
rm -rf /etc/update-motd.d/*.*

# clone big from big-0
git clone http://biginternetcompany.net:8888/big

# clone resource from big-0
git clone http://biginternetcompany.net:8888/resources

# clone resources from big-0
git clone http://biginternetcompany.net:8888/resource

# change directory into resource
cd resource

# install npm deps
sudo npm install

# link locally with npm
sudo npm link


#
# TODO: CLEANUP FOLLOWING BLOCK / FIX DEPS
#
cd ..
cd resources
sudo npm link resource
sudo npm link
sudo npm install nosqlite -g
sudo npm install prompt -g


cd ..
cd resource
sudo npm link resources

cd /root/resources/node_modules/big-command/
sudo npm install -g


cd /root/resources/ssh/
sudo npm link

cd /root/big
sudo npm link
sudo npm link resource

# run once to install deps
big

# start big replicator
node bin/big system groupadd --name big-users
node bin/big system useradd --user marak --group big-users --password b1gPPuol1